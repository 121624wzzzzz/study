# WSL2 Ubuntu æ·±åº¦å­¦ä¹ ç¯å¢ƒé…ç½®å®Œæ•´æŒ‡å—

> é…ç½®æ—¥æœŸ: 2025å¹´10æœˆ19æ—¥  
> é€‚ç”¨ç³»ç»Ÿ: WSL2 + Ubuntu  
> ç¡¬ä»¶ç¯å¢ƒ: RTX 4090 / CUDA 12.1

---

## ç›®å½•
1. [ç³»ç»Ÿåˆå§‹åŒ–](#1-ç³»ç»Ÿåˆå§‹åŒ–)
2. [Miniconda å®‰è£…ä¸é…ç½®](#2-miniconda-å®‰è£…ä¸é…ç½®)
3. [é•œåƒæºé…ç½®](#3-é•œåƒæºé…ç½®)
4. [Python ç¯å¢ƒæ¨¡æ¿åˆ›å»º](#4-python-ç¯å¢ƒæ¨¡æ¿åˆ›å»º)
5. [SSH è¿œç¨‹è®¿é—®é…ç½®](#5-ssh-è¿œç¨‹è®¿é—®é…ç½®)
6. [Tmux ä¼šè¯ç®¡ç†](#6-tmux-ä¼šè¯ç®¡ç†)
7. [å·¥ä½œç›®å½•ç»“æ„](#7-å·¥ä½œç›®å½•ç»“æ„)
8. [Git é…ç½®](#8-git-é…ç½®)
9. [Bash é…ç½®ä¼˜åŒ–](#9-bash-é…ç½®ä¼˜åŒ–)
10. [ç¯å¢ƒéªŒè¯](#10-ç¯å¢ƒéªŒè¯)
11. [å¸¸è§ä½¿ç”¨åœºæ™¯](#11-å¸¸è§ä½¿ç”¨åœºæ™¯)
12. [æ•…éšœæ’æŸ¥](#12-æ•…éšœæ’æŸ¥)

---

## 1. ç³»ç»Ÿåˆå§‹åŒ–

### 1.1 æ›´æ–°ç³»ç»Ÿ
```bash
sudo apt-get update && sudo apt-get upgrade -y
```

### 1.2 å®‰è£…åŸºç¡€å¼€å‘å·¥å…·
```bash
sudo apt-get install -y \
    build-essential \
    git \
    wget \
    curl \
    vim \
    tmux \
    htop \
    tree \
    zip \
    unzip \
    openssh-server
```

---

## 2. Miniconda å®‰è£…ä¸é…ç½®

### 2.1 ä¸‹è½½å¹¶å®‰è£… Miniconda
```bash
# ä¸‹è½½
cd ~
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

# å®‰è£…
bash Miniconda3-latest-Linux-x86_64.sh -b -p $HOME/miniconda3

# åˆå§‹åŒ–
~/miniconda3/bin/conda init bash
source ~/.bashrc
```

### 2.2 é…ç½® Conda è¡Œä¸º
```bash
# ç¦æ­¢è‡ªåŠ¨æ¿€æ´» base ç¯å¢ƒ
conda config --set auto_activate_base false
```

---

## 3. é•œåƒæºé…ç½®

### 3.1 Conda é•œåƒæºï¼ˆæ¸…åæºï¼‰
```bash
cat > ~/.condarc << 'EOF'
channels:
  - defaults
show_channel_urls: true
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
channel_priority: flexible
EOF

# æ¸…é™¤ç¼“å­˜
conda clean -i -y
```

### 3.2 æ¥å— Conda æœåŠ¡æ¡æ¬¾
```bash
conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main
conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r
```

### 3.3 é…ç½® pip é•œåƒæºï¼ˆæ¸…åæºï¼‰
```bash
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### 3.4 é…ç½® HuggingFace é•œåƒ
```bash
echo 'export HF_ENDPOINT=https://hf-mirror.com' >> ~/.bashrc
source ~/.bashrc
```

---

## 4. Python ç¯å¢ƒæ¨¡æ¿åˆ›å»º

### 4.1 åˆ›å»ºæ¨¡æ¿ç¯å¢ƒ
```bash
# åˆ›å»º Python 3.10 ç¯å¢ƒ
conda create -n template python=3.10 -y

# æ¿€æ´»ç¯å¢ƒ
conda activate template
```

### 4.2 å®‰è£… PyTorch (CUDA 12.1 é€‚é… RTX 4090)
```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

### 4.3 å®‰è£…æ ¸å¿ƒæ·±åº¦å­¦ä¹ åº“
```bash
pip install transformers==4.44.2
pip install datasets==2.21.0
pip install accelerate==0.34.2
pip install peft==0.12.0
pip install bitsandbytes==0.44.1
pip install scipy
```

### 4.4 å®‰è£…ç›‘æ§å’Œå·¥å…·åº“
```bash
pip install tensorboard wandb tqdm
pip install scikit-learn rouge-score nltk
```

### 4.5 å®‰è£…æ•°æ®å¤„ç†åº“
```bash
pip install pandas numpy matplotlib seaborn
```

### 4.6 å®‰è£…å¼€å‘å·¥å…·
```bash
pip install jupyter ipython ipywidgets
```

### 4.7 éªŒè¯å®‰è£…
```bash
python << 'EOF'
import torch
import transformers
import datasets
import peft
print(f"âœ… PyTorch: {torch.__version__}")
print(f"âœ… CUDA: {torch.cuda.is_available()}")
print(f"âœ… GPU: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else 'N/A'}")
print(f"âœ… Transformers: {transformers.__version__}")
print(f"âœ… æ‰€æœ‰æ ¸å¿ƒåº“å®‰è£…æˆåŠŸï¼")
EOF
```

### 4.8 åˆ›å»ºç¯å¢ƒå…‹éš†è„šæœ¬
```bash
# åˆ›å»ºå…‹éš†è„šæœ¬
cat > ~/clone_env.sh << 'EOF'
#!/bin/bash

if [ -z "$1" ]; then
    echo "ç”¨æ³•: ./clone_env.sh <æ–°ç¯å¢ƒå>"
    exit 1
fi

NEW_ENV=$1

echo "æ­£åœ¨ä» template å…‹éš†ç¯å¢ƒåˆ° $NEW_ENV ..."
conda create -n $NEW_ENV --clone template -y

echo "âœ… ç¯å¢ƒ $NEW_ENV åˆ›å»ºå®Œæˆï¼"
echo "æ¿€æ´»ç¯å¢ƒ: conda activate $NEW_ENV"
EOF

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x ~/clone_env.sh
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
~/clone_env.sh my-project
```

---

## 5. SSH è¿œç¨‹è®¿é—®é…ç½®

### 5.1 WSL2 ä¾§é…ç½®

#### ä¿®æ”¹ SSH ç«¯å£ï¼ˆé¿å…ä¸ Windows SSH å†²çªï¼‰
```bash
sudo sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config
```

#### å¯åŠ¨ SSH æœåŠ¡
```bash
sudo service ssh start
```

#### é…ç½®è‡ªåŠ¨å¯åŠ¨
```bash
echo 'sudo service ssh start 2>/dev/null' >> ~/.bashrc
```

#### é…ç½® sudo å…å¯†ç å¯åŠ¨ SSH
```bash
echo "$USER ALL=(ALL) NOPASSWD: /usr/sbin/service ssh start" | sudo tee /etc/sudoers.d/ssh-start
```

### 5.2 Windows ä¾§é…ç½®ï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰

#### æ·»åŠ ç«¯å£è½¬å‘è§„åˆ™
```powershell
# è·å– WSL2 IP åœ°å€
$wslIP = (wsl hostname -I).Trim()

# æ·»åŠ ç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=2222 connectaddress=$wslIP

# æ·»åŠ é˜²ç«å¢™è§„åˆ™
New-NetFirewallRule -DisplayName "WSL SSH" -Direction Inbound -LocalPort 2222 -Protocol TCP -Action Allow

# éªŒè¯ç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy show all
```

### 5.3 SSH è¿æ¥æµ‹è¯•

#### ä»å…¶ä»–è®¾å¤‡è¿æ¥
```bash
ssh -p 2222 wz@<Windowsä¸»æœºIP>
```

#### é…ç½® SSH å…å¯†ç™»å½•ï¼ˆå¯é€‰ï¼‰
```bash
# åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šç”Ÿæˆå¯†é’¥
ssh-keygen -t ed25519 -C "your.email@example.com"

# å°†å…¬é’¥å¤åˆ¶åˆ° WSL2
ssh-copy-id -p 2222 wz@<Windowsä¸»æœºIP>
```

---

## 6. Tmux ä¼šè¯ç®¡ç†

### 6.1 é…ç½® Tmux
```bash
cat > ~/.tmux.conf << 'EOF'
# é¼ æ ‡æ”¯æŒ
set -g mouse on

# çŠ¶æ€æ æ ·å¼
set -g status-bg colour235
set -g status-fg colour136

# ä¼šè¯åæ˜¾ç¤º
set -g status-left '#[fg=green](#S) '

# çª—å£ç´¢å¼•ä» 1 å¼€å§‹
set -g base-index 1
set -g pane-base-index 1
EOF
```

### 6.2 Tmux å¸¸ç”¨å‘½ä»¤
```bash
# åˆ›å»ºæ–°ä¼šè¯
tmux new -s session_name

# åˆ—å‡ºæ‰€æœ‰ä¼šè¯
tmux ls

# é‡æ–°è¿æ¥ä¼šè¯
tmux attach -t session_name

# åˆ†ç¦»ä¼šè¯ï¼ˆä»»åŠ¡ç»§ç»­è¿è¡Œï¼‰
# å¿«æ·é”®: Ctrl+B, ç„¶åæŒ‰ D

# åˆ é™¤ä¼šè¯
tmux kill-session -t session_name

# åœ¨ä¼šè¯ä¸­åˆ›å»ºæ–°çª—å£
# å¿«æ·é”®: Ctrl+B, ç„¶åæŒ‰ C

# åˆ‡æ¢çª—å£
# å¿«æ·é”®: Ctrl+B, ç„¶åæŒ‰ 0-9
```

---

## 7. å·¥ä½œç›®å½•ç»“æ„

### 7.1 åˆ›å»ºæ ‡å‡†å·¥ä½œç›®å½•
```bash
mkdir -p ~/workspace/{projects,datasets,models,scripts,notebooks}
```

### 7.2 ç›®å½•è¯´æ˜
- `~/workspace/projects` - é¡¹ç›®ä»£ç 
- `~/workspace/datasets` - æ•°æ®é›†
- `~/workspace/models` - æ¨¡å‹æƒé‡
- `~/workspace/scripts` - è„šæœ¬æ–‡ä»¶
- `~/workspace/notebooks` - Jupyter notebooks

---

## 8. Git é…ç½®

```bash
# é…ç½®ç”¨æˆ·ä¿¡æ¯
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# é…ç½®é»˜è®¤ç¼–è¾‘å™¨
git config --global core.editor vim

# é…ç½®é»˜è®¤åˆ†æ”¯å
git config --global init.defaultBranch main

# æŸ¥çœ‹é…ç½®
git config --list
```

---

## 9. Bash é…ç½®ä¼˜åŒ–

### 9.1 æ·»åŠ é…ç½®åˆ° ~/.bashrc
```bash
cat >> ~/.bashrc << 'EOF'

# ============ è‡ªåŠ¨å¯åŠ¨æœåŠ¡ ============
sudo service ssh start 2>/dev/null

# ============ ç¯å¢ƒå˜é‡ ============
export HF_ENDPOINT=https://hf-mirror.com
export WORKSPACE=~/workspace

# ============ å¸¸ç”¨åˆ«å ============
# æ–‡ä»¶æ“ä½œ
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Git å¿«æ·å‘½ä»¤
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git pull'
alias gps='git push'

# Conda ç¯å¢ƒç®¡ç†
alias ca='conda activate'
alias cda='conda deactivate'
alias clist='conda env list'
alias cclone='~/clone_env.sh'
alias crm='conda env remove -n'

# å·¥ä½œåŒºå¿«æ·è·³è½¬
alias ws='cd $WORKSPACE'
alias proj='cd $WORKSPACE/projects'
alias data='cd $WORKSPACE/datasets'
alias models='cd $WORKSPACE/models'

# tmux å¿«æ·å‘½ä»¤
alias tl='tmux ls'
alias ta='tmux attach -t'
alias tn='tmux new -s'
EOF
```

### 9.2 åº”ç”¨é…ç½®
```bash
source ~/.bashrc
```

---

## 10. ç¯å¢ƒéªŒè¯

### 10.1 ç³»ç»Ÿå·¥å…·æ£€æŸ¥
```bash
# æ£€æŸ¥ç³»ç»Ÿå·¥å…·
git --version
conda --version
tmux -V
ssh -V
python --version
```

### 10.2 Conda ç¯å¢ƒæ£€æŸ¥
```bash
conda env list
```

### 10.3 é•œåƒé…ç½®æ£€æŸ¥
```bash
echo $HF_ENDPOINT
pip config list
cat ~/.condarc
```

### 10.4 PyTorch å’Œ CUDA æ£€æŸ¥
```bash
conda activate template
python -c "import torch; print(f'PyTorch: {torch.__version__}'); print(f'CUDA: {torch.cuda.is_available()}'); print(f'GPU: {torch.cuda.get_device_name(0)}')"
```

### 10.5 SSH æœåŠ¡æ£€æŸ¥
```bash
sudo service ssh status
ss -tlnp | grep 2222
```

### 10.6 å·¥ä½œç›®å½•æ£€æŸ¥
```bash
ls -la ~/workspace/
```

---

## 11. å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: åˆ›å»ºæ–°é¡¹ç›®ç¯å¢ƒå¹¶å¼€å§‹è®­ç»ƒ

```bash
# 1. å…‹éš†æ¨¡æ¿ç¯å¢ƒ
~/clone_env.sh llama-lora

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate llama-lora

# 3. å®‰è£…é¡¹ç›®ç‰¹å®šä¾èµ–
pip install flash-attn

# 4. ä½¿ç”¨ tmux ä¿æŒè®­ç»ƒ
tmux new -s training
cd ~/workspace/projects/llama-lora
python train.py

# 5. åˆ†ç¦» tmuxï¼ˆCtrl+B, Dï¼‰
# è®­ç»ƒç»§ç»­åœ¨åå°è¿è¡Œ
```

### åœºæ™¯ 2: è¿œç¨‹æŸ¥çœ‹è®­ç»ƒè¿›åº¦

```bash
# 1. ä»è¿œç¨‹æœºå™¨ SSH è¿æ¥
ssh -p 2222 wz@<Windows_IP>

# 2. æŸ¥çœ‹ç°æœ‰ tmux ä¼šè¯
tmux ls

# 3. è¿æ¥åˆ°è®­ç»ƒä¼šè¯
tmux attach -t training

# 4. æ£€æŸ¥è®­ç»ƒçŠ¶æ€
# æŸ¥çœ‹ GPU ä½¿ç”¨æƒ…å†µ
nvidia-smi

# 5. æŸ¥çœ‹æ—¥å¿—
tail -f train.log

# 6. åˆ†ç¦»ä¼šè¯ç»§ç»­è®­ç»ƒ
# Ctrl+B, D
```

### åœºæ™¯ 3: ä½¿ç”¨ Jupyter Notebook

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate template

# 2. å¯åŠ¨ Jupyter
cd ~/workspace/notebooks
jupyter notebook --no-browser --port=8888

# 3. åœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—®
# http://localhost:8888
```

---

## 12. æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: SSH æ— æ³•è¿æ¥

**è§£å†³æ–¹æ¡ˆï¼š** åœ¨ Windows PowerShellï¼ˆç®¡ç†å‘˜ï¼‰ä¸­é‡æ–°é…ç½®ç«¯å£è½¬å‘
```powershell
$wslIP = (wsl hostname -I).Trim()
netsh interface portproxy delete v4tov4 listenport=2222 listenaddress=0.0.0.0
netsh interface portproxy add v4tov4 listenport=2222 listenaddress=0.0.0.0 connectport=2222 connectaddress=$wslIP
```

### é—®é¢˜ 2: Conda ç¯å¢ƒåˆ›å»ºå¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š** æ¸…é™¤ç¼“å­˜é‡è¯•
```bash
conda clean -a -y
conda create -n template python=3.10 -y
```

### é—®é¢˜ 3: PyTorch æ— æ³•è¯†åˆ« GPU

**è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥ CUDA é©±åŠ¨å¹¶é‡æ–°å®‰è£…
```bash
# æ£€æŸ¥ CUDA é©±åŠ¨
nvidia-smi

# é‡æ–°å®‰è£…æ­£ç¡®çš„ PyTorch ç‰ˆæœ¬
pip uninstall torch torchvision torchaudio -y
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

---

## é™„å½•ï¼šå¿«é€Ÿå‚è€ƒå¡

### Conda ç¯å¢ƒç®¡ç†
```bash
clist          # åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒ
ca <env>       # æ¿€æ´»ç¯å¢ƒ
cda            # é€€å‡ºç¯å¢ƒ
cclone <new>   # å…‹éš†æ¨¡æ¿ç¯å¢ƒ
crm <env>      # åˆ é™¤ç¯å¢ƒ
```

### Tmux ä¼šè¯ç®¡ç†
```bash
tl             # åˆ—å‡ºä¼šè¯
tn <name>      # åˆ›å»ºæ–°ä¼šè¯
ta <name>      # è¿æ¥ä¼šè¯
Ctrl+B, D      # åˆ†ç¦»ä¼šè¯
```

### å·¥ä½œåŒºå¿«æ·è·³è½¬
```bash
ws             # è·³è½¬åˆ°å·¥ä½œåŒºæ ¹ç›®å½•
proj           # è·³è½¬åˆ°é¡¹ç›®ç›®å½•
data           # è·³è½¬åˆ°æ•°æ®é›†ç›®å½•
models         # è·³è½¬åˆ°æ¨¡å‹ç›®å½•
```

### Git å¿«æ·å‘½ä»¤
```bash
gs             # git status
ga             # git add
gc             # git commit
gp             # git pull
gps            # git push
```

---

**é…ç½®å®Œæˆï¼å¼€å§‹ä½ çš„æ·±åº¦å­¦ä¹ ä¹‹æ—…å§ï¼** ğŸš€